name: Release

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  build:
    name: æ„å»ºå‘å¸ƒç‰ˆæœ¬
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: è®¾ç½® Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: å®‰è£…ä¾èµ–
      run: npm ci
      
    - name: æ„å»ºé¡¹ç›®
      run: npm run build
      
    - name: åˆ›å»ºå‘å¸ƒåŒ…
      run: |
        cd dist
        tar -czf ../mynav-${{ github.ref_name }}.tar.gz .
        cd ..
        zip -r mynav-${{ github.ref_name }}.zip dist/
        
    - name: ç”Ÿæˆæ›´æ”¹æ—¥å¿—
      id: changelog
      run: |
        if [ -f CHANGELOG.md ]; then
          echo "changelog_content<<EOF" >> $GITHUB_OUTPUT
          cat CHANGELOG.md >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
        else
          echo "changelog_content=æŸ¥çœ‹å®Œæ•´æ›´æ”¹æ—¥å¿—è¯·è®¿é—®æäº¤å†å²ã€‚" >> $GITHUB_OUTPUT
        fi
        
    - name: åˆ›å»º GitHub Release
      uses: softprops/action-gh-release@v1
      with:
        name: MyNav ${{ github.ref_name }}
        body: |
          ## ğŸ‰ MyNav ${{ github.ref_name }} å‘å¸ƒ

          ### ğŸ“¦ ä¸‹è½½
          - [æºä»£ç å‹ç¼©åŒ… (.tar.gz)](https://github.com/${{ github.repository }}/releases/download/${{ github.ref_name }}/mynav-${{ github.ref_name }}.tar.gz)
          - [æºä»£ç å‹ç¼©åŒ… (.zip)](https://github.com/${{ github.repository }}/releases/download/${{ github.ref_name }}/mynav-${{ github.ref_name }}.zip)

          ### ğŸš€ åœ¨çº¿ä½“éªŒ
          [ç‚¹å‡»è¿™é‡Œåœ¨çº¿ä½“éªŒ](https://nav.xifan.uno)

          ### ğŸ“ æ›´æ”¹å†…å®¹
          ${{ steps.changelog.outputs.changelog_content }}

          ### ğŸ”§ å®‰è£…å’Œä½¿ç”¨
          ```bash
          # å…‹éš†ä»“åº“
          git clone https://github.com/${{ github.repository }}.git
          cd mynav

          # å®‰è£…ä¾èµ–
          npm install

          # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
          npm run dev
          ```

          ---
          å®Œæ•´çš„ä½¿ç”¨æ–‡æ¡£è¯·æŸ¥çœ‹ [README.md](https://github.com/${{ github.repository }}/blob/main/README.md)
        files: |
          mynav-${{ github.ref_name }}.tar.gz
          mynav-${{ github.ref_name }}.zip
        draft: false
        prerelease: ${{ contains(github.ref_name, 'alpha') || contains(github.ref_name, 'beta') || contains(github.ref_name, 'rc') }}
        generate_release_notes: true